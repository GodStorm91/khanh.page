<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="description" content="To share is to learn">

        <meta property="og:title" content="TIL - 404 Redirect in S3 static blog post | Khanh&#039;s Blog"/>
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://godstorm91.github.io/khanh.page/blog/til-404-redirect-in-s3"/>
        <meta property="og:description" content="To share is to learn" />

        <title>Khanh&#039;s Blog | TIL - 404 Redirect in S3 static blog post</title>

        <link rel="home" href="https://godstorm91.github.io/khanh.page">
        <link rel="icon" href="https://godstorm91.github.io/khanh.page/favicon.ico">
        <link href="https://godstorm91.github.io/khanh.page/blog/feed.atom" type="application/atom+xml" rel="alternate" title="Khanh&#039;s Blog Atom Feed">

            <meta property="og:title" content="TIL - 404 Redirect in S3 static blog post" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://godstorm91.github.io/khanh.page/blog/til-404-redirect-in-s3"/>
    <meta property="og:description" content="S3" />

                    <!-- Insert analytics code here -->
        
        <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:300,300i,400,400i,700,700i,800,800i" rel="stylesheet">
        <link rel="stylesheet" href="https://godstorm91.github.io/khanh.page/assets/build/css/main.css?id=c1d698e2c626f92a1cd4">
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-76723458-7"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-76723458-7');
</script>

    </head>

    <body class="flex flex-col justify-between min-h-screen bg-grey-lighter text-white leading-normal font-sans">
        <header class="flex items-center shadow bg-grey-darkest border-b border-grey-darker h-24 py-4" role="banner">
            <div class="container flex items-center max-w-4xl mx-auto px-4 lg:px-8">
                <div class="flex items-center">
                    <a href="https://godstorm91.github.io/khanh.page" title="Khanh&#039;s Blog home" class="inline-flex items-center">
                        <img class="h-8 md:h-10 mr-3" src="https://godstorm91.github.io/khanh.page/assets/img/logo.svg" alt="Khanh&#039;s Blog logo" />

                        <h1 class="text-lg md:text-2xl text-purple-light font-semibold hover:text-pink my-0">Khanh&#039;s Blog</h1>
                    </a>
                </div>

                <div id="vue-search" class="flex flex-1 justify-end items-center">
                    <search></search>

                    <button
    id="theme-toggle-btn"
    class="flex justify-center items-center bg-purple border border-purple h-10 w-10 rounded-full focus:outline-none ml-2 hover:bg-purple-light transition-colors duration-200"
    onclick="handleThemeToggle()"
    aria-label="Toggle theme"
    title="Toggle light/dark theme"
>
    <svg id="theme-icon-sun" xmlns="http://www.w3.org/2000/svg"
        class="hidden fill-current text-white h-6 w-6" viewBox="0 0 24 24"
    >
        <path d="M12 18C8.68629 18 6 15.3137 6 12C6 8.68629 8.68629 6 12 6C15.3137 6 18 8.68629 18 12C18 15.3137 15.3137 18 12 18ZM12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16ZM11 1H13V4H11V1ZM11 20H13V23H11V20ZM3.51472 4.92893L4.92893 3.51472L7.05025 5.63604L5.63604 7.05025L3.51472 4.92893ZM16.9497 18.364L18.364 16.9497L20.4853 19.0711L19.0711 20.4853L16.9497 18.364ZM19.0711 3.51472L20.4853 4.92893L18.364 7.05025L16.9497 5.63604L19.0711 3.51472ZM5.63604 16.9497L7.05025 18.364L4.92893 20.4853L3.51472 19.0711L5.63604 16.9497ZM23 11V13H20V11H23ZM4 11V13H1V11H4Z"/>
    </svg>

    <svg id="theme-icon-moon" xmlns="http://www.w3.org/2000/svg"
        class="fill-current text-white h-6 w-6" viewBox="0 0 24 24"
    >
        <path d="M10 7C10 10.866 13.134 14 17 14C18.9584 14 20.729 13.1957 21.9995 11.8995C22 11.933 22 11.9665 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C12.0335 2 12.067 2 12.1005 2.00049C10.8043 3.27098 10 5.04157 10 7ZM4 12C4 16.4183 7.58172 20 12 20C15.0583 20 17.7158 18.2839 19.062 15.7621C18.3945 15.9187 17.7035 16 17 16C12.0294 16 8 11.9706 8 7C8 6.29648 8.08133 5.60547 8.2379 4.938C5.71611 6.28423 4 8.9417 4 12Z"/>
    </svg>
</button>


                    <nav class="hidden lg:flex items-center justify-end text-lg">
    <a title="Khanh&#039;s Blog Blog" href="https://godstorm91.github.io/khanh.page/blog"
        class="ml-6 text-grey-darker hover:text-blue-dark ">
        Blog
    </a>

    <a title="Khanh&#039;s Blog About" href="https://godstorm91.github.io/khanh.page/about"
        class="ml-6 text-grey-darker hover:text-blue-dark ">
        About
    </a>

    <a title="Khanh&#039;s Blog Contact" href="https://godstorm91.github.io/khanh.page/contact"
        class="ml-6 text-grey-darker hover:text-blue-dark ">
        Contact
    </a>
</nav>

                    <button class="flex justify-center items-center bg-blue border border-blue h-10 px-5 rounded-full lg:hidden focus:outline-none"
    onclick="navMenu.toggle()"
>
    <svg id="js-nav-menu-show" xmlns="http://www.w3.org/2000/svg"
        class="fill-current text-white h-9 w-4" viewBox="0 0 32 32"
    >
        <path d="M4,10h24c1.104,0,2-0.896,2-2s-0.896-2-2-2H4C2.896,6,2,6.896,2,8S2.896,10,4,10z M28,14H4c-1.104,0-2,0.896-2,2  s0.896,2,2,2h24c1.104,0,2-0.896,2-2S29.104,14,28,14z M28,22H4c-1.104,0-2,0.896-2,2s0.896,2,2,2h24c1.104,0,2-0.896,2-2  S29.104,22,28,22z"/>
    </svg>

    <svg id="js-nav-menu-hide" xmlns="http://www.w3.org/2000/svg"
        class="hidden fill-current text-white h-9 w-4" viewBox="0 0 36 30"
    >
        <polygon points="32.8,4.4 28.6,0.2 18,10.8 7.4,0.2 3.2,4.4 13.8,15 3.2,25.6 7.4,29.8 18,19.2 28.6,29.8 32.8,25.6 22.2,15 "/>
    </svg>
</button>

                </div>
            </div>
        </header>

        <nav id="js-nav-menu" class="nav-menu hidden lg:hidden">
    <ul class="list-reset my-0">
        <li class="pl-4">
            <a
                title="Khanh&#039;s Blog Blog"
                href="https://godstorm91.github.io/khanh.page/blog"
                class="nav-menu__item hover:text-blue "
            >Blog</a>
        </li>
        <li class="pl-4">
            <a
                title="Khanh&#039;s Blog About"
                href="https://godstorm91.github.io/khanh.page/about"
                class="nav-menu__item hover:text-blue "
            >About</a>
        </li>
        <li class="pl-4">
            <a
                title="Khanh&#039;s Blog Contact"
                href="https://godstorm91.github.io/khanh.page/contact"
                class="nav-menu__item hover:text-blue "
            >Contact</a>
        </li>
    </ul>
</nav>

        <main role="main" class="flex-auto w-full container max-w-xl mx-auto py-16 px-6">
                
    <h1 class="leading-none mb-2">TIL - 404 Redirect in S3 static blog post</h1>

    <p class="text-grey-darker text-xl md:mt-0">Khanh Nguyen  â€¢  June 20, 2019</p>

                        <a
                href="/blog/categories/til"
                title="View posts in til"
                class="inline-block bg-grey-light hover:bg-blue-lighter leading-loose tracking-wide text-grey-darkest uppercase text-xs font-semibold rounded mr-4 px-3 pt-px"
            >til</a>
             <h1 class="text-4xl md:text-5xl lg:text-6xl font-normal"></h1>
    <main class="mt-6 sm:mt-12 text-lg antialiased leading-normal" role="main">
            </main>
    <div class="border-b border-blue-lighter mb-10 pb-4" v-pre>
        <p>Today I received a comment from my friends telling me that my blog doesn't redirect to 404.
Oops...
I should have been set it from the beginning instead of making my blog showing something like this:</p>
<pre><code>403 Forbidden
Code: AccessDenied
Message: Access Denied
RequestId: 5F9506201FD3BF09
HostId: DlHKCh+6eIyX1OILlLEt2FVz2BMgn3luo6lNcx6xxMr3F0wntH5jDqHQ78Q77i1JWcoEN9xb//c=</code></pre>
<p>We should have been let user see something much more <strong>friendly</strong> instead of something frank, coldhearted like the error above.
Below is the steps I have done to make it works.</p>
<ol>
<li>Create a 404 folder and its content (the friendlier things I want my user to see)</li>
<li>Settings S3 error pages in AWS console</li>
<li>Invalidate cloudfront cache (in case you are using Cloudfront as your CDN)</li>
</ol>
<h3>1. Create a 404 folder</h3>
<p>I've used <code>Jigsaw</code> as my blog cms, so things is super easy. I just have to create a <code>404.blade.php</code> and put it in my root directory. When I do compile the code for deploy, <code>404.html</code> file will be generated.</p>
<pre><code class="language-html">@extends('_layouts.master')

@section('body')
    &lt;div class="flex flex-col items-center text-grey-darker mt-32"&gt;
        &lt;h1 class="text-6xl font-light leading-none mb-2"&gt;404&lt;/h1&gt;

        &lt;h2 class="text-3xl"&gt;Page not found.&lt;/h2&gt;

        &lt;hr class="block w-full max-w-sm mx-auto border my-8"&gt;

        &lt;p class="text-xl"&gt;
            Need to update this page? See the &lt;a title="404 Page Documentation" href="https://jigsaw.tighten.co/docs/custom-404-page/"&gt;Jigsaw documentation&lt;/a&gt;.
        &lt;/p&gt;
    &lt;/div&gt;
@endsection</code></pre>
<p>Now, things is pretty better like this </p>
<p><img src="/assets/img/custom-404.png" alt="404-image" /></p>
<h3>2. Settings S3 error pages in AWS Console</h3>
<p>S3 console provide a way to set your error pages (whenever some key is not found or permission forbidden)
You can set the error pages as below (the path will be based on the bucket root directory )</p>
<p><img src="/assets/img/s3-error-config.png" alt="s3-error-config" /></p>
<p>If you don't use any CDN, you can skip step 3, everything now should work fine.
If you use CDN, you need to clear the cache (or request invalidation as in AWS )</p>
<h3>3. Create invalidation request</h3>
<p>You can use AWS Console to create invalition request ( a cache clear request - all of the cache will be updated to the newest contents from origin - so this is an expensive step, please use it considerably).</p>
<p>I use aws command line to create invalidation, you can use my command or console to create invalidation.</p>
<pre><code class="language-bash"> aws cloudfront create-invalidation --distribution-id &lt;distribution_id&gt; --paths "/*" --profile &lt;profile_id&gt;</code></pre>
<p>After that, you can confirm whether your changes have been updated and delegated to all edge locations
(Please wait about 4,5 minutes for changes completely reflected all edge locations.)</p>    </div>

    <nav class="flex justify-between text-sm md:text-base">
        <div>
                            <a href="https://godstorm91.github.io/khanh.page/blog/what-i-read-beginner-mind-zen-beginner&#039;s-mind" title="Older Post: What I read - Zen Mind, Beginner&#039;s Mind Informal Talks on Zen Meditation and Practice">
                    &LeftArrow; What I read - Zen Mind, Beginner&#039;s Mind Informal Talks on Zen Meditation and Practice
                </a>
                    </div>

        <div>
                            <a href="https://godstorm91.github.io/khanh.page/blog/tips-fix-fuelphp-email-header-broken" title="Newer Post: TIPS - How to fix header broken in FuelPHP">
                    TIPS - How to fix header broken in FuelPHP &RightArrow;
                </a>
                    </div>
    </nav>
        </main>

        <footer class="bg-grey-darkest text-center text-sm mt-12 py-4 border-t border-grey-darker" role="contentinfo">
            <ul class="flex flex-col md:flex-row justify-center list-reset">
                <li class="md:mr-2 text-grey-light">
                    &copy; <a href="https://tighten.co" title="Tighten website">Tighten</a> 2025.
                </li>

                <li class="text-grey-light">
                    Built with <a href="http://jigsaw.tighten.co" title="Jigsaw by Tighten">Jigsaw</a>
                    and <a href="https://tailwindcss.com" title="Tailwind CSS, a utility-first CSS framework">Tailwind CSS</a>.
                </li>
            </ul>
        </footer>

        <script src="https://godstorm91.github.io/khanh.page/assets/build/js/main.js?id=c1858ddd9ae16f7e888b"></script>

        <script>
    function handleThemeToggle() {
        const newTheme = window.themeToggle();
        updateThemeIcon(newTheme);
    }

    function updateThemeIcon(theme) {
        const sunIcon = document.getElementById('theme-icon-sun');
        const moonIcon = document.getElementById('theme-icon-moon');

        if (theme === 'light') {
            sunIcon.classList.remove('hidden');
            moonIcon.classList.add('hidden');
        } else {
            sunIcon.classList.add('hidden');
            moonIcon.classList.remove('hidden');
        }
    }

    // Set initial icon based on current theme
    document.addEventListener('DOMContentLoaded', function() {
        const currentTheme = window.getTheme();
        updateThemeIcon(currentTheme);
    });
</script>
<script>
    const navMenu = {
        toggle() {
            const menu = document.getElementById('js-nav-menu');
            menu.classList.toggle('hidden');
            menu.classList.toggle('lg:block');
            document.getElementById('js-nav-menu-hide').classList.toggle('hidden');
            document.getElementById('js-nav-menu-show').classList.toggle('hidden');
        },
    }
</script>
    </body>
            
</html>
